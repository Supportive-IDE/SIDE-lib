"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExecutionLine=void 0;var _symptom=require("../problem-finder/symptom.js"),_compoundExpression2=require("./compoundExpression.js"),_expression=require("./expression.js"),_identifiers=require("./identifiers.js");function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _createForOfIteratorHelper(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,n=function(){};return{s:n,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){a=!0,r=e},f:function(){try{o||null==i.return||i.return()}finally{if(a)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _classPrivateMethodInitSpec(e,t){_checkPrivateRedeclaration(e,t),t.add(e)}function _classPrivateFieldInitSpec(e,t,i){_checkPrivateRedeclaration(e,t),t.set(e,i)}function _checkPrivateRedeclaration(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _classPrivateMethodGet(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}function _classPrivateFieldSet(e,t,i){return _classApplyDescriptorSet(e,_classExtractFieldDescriptor(e,t,"set"),i),i}function _classApplyDescriptorSet(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}function _classPrivateFieldGet(e,t){return _classApplyDescriptorGet(e,_classExtractFieldDescriptor(e,t,"get"))}function _classExtractFieldDescriptor(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function _classApplyDescriptorGet(e,t){return t.get?t.get.call(e):t.value}var _lines=new WeakMap,_block=new WeakMap,_compoundExpression=new WeakMap,_symptoms=new WeakMap,_closeFunctionCall=new WeakSet,_findStartOfWordyBooleanExpression=new WeakSet,_findOpeningExpression=new WeakSet,_checkForRedundantTernary=new WeakSet,_checkForWordyBool=new WeakSet,_getLocalLineNumber=new WeakSet,_processBooleanExpression=new WeakSet,_isPossibleSplitComparisonOperator=new WeakSet,ExecutionLine=function(){function e(t,i){_classCallCheck(this,e),_classPrivateMethodInitSpec(this,_isPossibleSplitComparisonOperator),_classPrivateMethodInitSpec(this,_processBooleanExpression),_classPrivateMethodInitSpec(this,_getLocalLineNumber),_classPrivateMethodInitSpec(this,_checkForWordyBool),_classPrivateMethodInitSpec(this,_checkForRedundantTernary),_classPrivateMethodInitSpec(this,_findOpeningExpression),_classPrivateMethodInitSpec(this,_findStartOfWordyBooleanExpression),_classPrivateMethodInitSpec(this,_closeFunctionCall),_classPrivateFieldInitSpec(this,_lines,{writable:!0,value:[]}),_classPrivateFieldInitSpec(this,_block,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_compoundExpression,{writable:!0,value:void 0}),_classPrivateFieldInitSpec(this,_symptoms,{writable:!0,value:[]}),_classPrivateFieldGet(this,_lines).push(t),_classPrivateFieldSet(this,_block,i),_classPrivateFieldSet(this,_compoundExpression,new _compoundExpression2.CompoundExpression(t.contains(_expression.ExpressionEntity.ContinuationLine)))}return _createClass(e,[{key:"addLine",value:function(e){if(_classPrivateFieldGet(this,_lines).push(e),_classPrivateFieldGet(this,_lines).length>1){var t=_classPrivateFieldGet(this,_lines)[_classPrivateFieldGet(this,_lines).length-1].getFirstExpression();void 0!==t&&t.is(_expression.ExpressionEntity.OpenParenthesis)&&_classPrivateFieldGet(this,_lines)[_classPrivateFieldGet(this,_lines).length-2].reevaluateLastExpression(t);for(var i=_classPrivateFieldGet(this,_lines)[0].getRawContent(!0).length,s=1;s<_classPrivateFieldGet(this,_lines).length-1;s++)i+=_classPrivateFieldGet(this,_lines)[s].getRawContent(!0).length-_classPrivateFieldGet(this,_lines)[s].getIndent();var n,r=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines)[_classPrivateFieldGet(this,_lines).length-1].getExpressions());try{for(r.s();!(n=r.n()).done;){var o=n.value;o.setLocalIndex(o.getLocalIndex()+i-_classPrivateFieldGet(this,_lines)[_classPrivateFieldGet(this,_lines).length-1].getIndent())}}catch(e){r.e(e)}finally{r.f()}}}},{key:"containsLine",value:function(e){var t,i=!1,s=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(s.s();!(t=s.n()).done;){if(t.value.getLineNumber()===e){i=!0;break}}}catch(e){s.e(e)}finally{s.f()}return i}},{key:"minLine",value:function(){return 0===_classPrivateFieldGet(this,_lines).length?-1:_classPrivateFieldGet(this,_lines)[0].getLineNumber()}},{key:"maxLine",value:function(){return 0===_classPrivateFieldGet(this,_lines).length?-1:_classPrivateFieldGet(this,_lines)[_classPrivateFieldGet(this,_lines).length-1].getLineNumber()}},{key:"isBlank",value:function(){return 0===_classPrivateFieldGet(this,_lines).length||_classPrivateFieldGet(this,_lines)[0].isBlank()}},{key:"isBlockDefinition",value:function(){return _classPrivateFieldGet(this,_lines).length>0&&_classPrivateFieldGet(this,_lines)[0].isBlockDefinition()}},{key:"isFunctionDefinition",value:function(){return this.isBlockDefinition()&&_classPrivateFieldGet(this,_lines)[0].getExpressions()[0].getEntity()===_expression.ExpressionEntity.FunctionDefinition}},{key:"isConditionalDefinition",value:function(){return this.isBlockDefinition()&&_classPrivateFieldGet(this,_lines)[0].getExpressions()[0].isOneOfEntities([_expression.ExpressionEntity.IfDefinition,_expression.ExpressionEntity.ElifDefinition,_expression.ExpressionEntity.ElseDefinition])}},{key:"isVariableAssigned",value:function(e){var t=this.getExpressions(),i=this.convertLineIndexToLocalIndex(e.getLineNumber(),e.getIndex()),s=this.indexOfEntity(_expression.ExpressionEntity.AssignmentOperator);if(-1===i||this.isExpressionInFunctionCall(i))return!1;if(s>i&&(s===i+1||t[i+1].is(_expression.ExpressionEntity.Comma)))return!0;var n=this.getSequencesOfPattern([[_expression.ExpressionEntity.VariableName],[_expression.ExpressionEntity.AssignmentOperator]]).flat();if(n.length<=2||!n.includes(i))return!1;for(var r=n[0]===i,o=1;o<n.length;o++)if(n[o]===i&&(r=!0),n[o]!==n[o-1]+1)return!(!r&&o<2);return!0}},{key:"isForLoopVariable",value:function(e){var t=this.convertLineIndexToLocalIndex(e.getLineNumber(),e.getIndex()),i=this.indexOfEntity(_expression.ExpressionEntity.ForDefinition),s=this.indexOfEntity(_expression.ExpressionEntity.InKeyword);return-1!==t&&-1!==i&&-1!==s&&!this.isExpressionInFunctionCall(t)&&(i<t&&t<s)}},{key:"isPrintVariable",value:function(e){var t=this.getExpressions(),i=t[e].getValue();if(("sep"===i||"end"==i)&&e<t.length-1&&t[e+1].is(_expression.ExpressionEntity.AssignmentOperator)){for(var s=0,n=!1,r=0;r<e&&r<t.length;r++)t[r].is(_expression.ExpressionEntity.PrintFunction)?n=!0:n&&(t[r].is(_expression.ExpressionEntity.OpenParenthesis)?s++:t[r].is(_expression.ExpressionEntity.CloseParenthesis)&&(0===s&&(n=!1)));return n}return!1}},{key:"isVariableIncremented",value:function(e){var t=this.convertLineIndexToLocalIndex(e.getLineNumber(),e.getIndex());return t>=0&&(this.indexOfEntity(_expression.ExpressionEntity.IncrementOperator)===t+1||this.indexOfEntity(_expression.ExpressionEntity.DecrementOperator)===t+1||this.indexOfEntity(_expression.ExpressionEntity.MultiplyAssignOperator)===t+1||this.indexOfEntity(_expression.ExpressionEntity.DivideAssignOperator)===t+1||this.indexOfEntity(_expression.ExpressionEntity.RemainderAssignOperator)===t+1||this.indexOfEntity(_expression.ExpressionEntity.ExponentAssignOperator)===t+1||this.indexOfEntity(_expression.ExpressionEntity.IntDivideAssignOperator)===t+1)}},{key:"isVariablePassedToFunction",value:function(e){var t=this.convertLineIndexToLocalIndex(e.getLineNumber(),e.getIndex());return this.isExpressionInFunctionCall(t)}},{key:"isExpressionInFunctionCall",value:function(e){if(e<=0)return!1;for(var t=0,i=this.getExpressions(),s=0;s<e&&s<i.length;s++)if(i[s].isOneOfCategories([_expression.ExpressionCategory.BuiltInFunctions,_expression.ExpressionCategory.BuiltInMethods,_expression.ExpressionCategory.OtherMethods])||i[s].is(_expression.ExpressionEntity.FunctionName)&&s>0&&!i[s-1].is(_expression.ExpressionEntity.FunctionDefinition))t++;else if(i[s].is(_expression.ExpressionEntity.OpenParenthesis)){var n=_classPrivateMethodGet(this,_closeFunctionCall,_closeFunctionCall2).call(this,s,i);if(t>0&&n>e)return!0;s=n,t--}return!1}},{key:"isExpressionInGroup",value:function(e){for(var t=this.getExpressions(),i=function(e,t){return e>t},s=0,n=0,r=0,o=0,a=0,l=0,p=e-1;p>=0;p--)if(t[p].is(_expression.ExpressionEntity.OpenParenthesis)){if(i(++s,n))return!0}else if(t[p].is(_expression.ExpressionEntity.CloseParenthesis))n++;else if(t[p].is(_expression.ExpressionEntity.OpenSquareBracket)){if(i(++r,o))return!0}else if(t[p].is(_expression.ExpressionEntity.CloseSquareBracket))o++;else if(t[p].is(_expression.ExpressionEntity.OpenBrace)){if(i(++a,l))return!0}else t[p].is(_expression.ExpressionEntity.CloseBrace)&&l++;return!1}},{key:"getBlock",value:function(){return _classPrivateFieldGet(this,_block)}},{key:"getExpressions",value:function(){var e,t=[],i=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(i.s();!(e=i.n()).done;){var s=e.value;t=t.concat(s.getExpressions())}}catch(e){i.e(e)}finally{i.f()}return t}},{key:"getVariableUsages",value:function(){var e,t=[],i=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(i.s();!(e=i.n()).done;){var s=e.value;t=t.concat(s.getVariableUsages())}}catch(e){i.e(e)}finally{i.f()}return t}},{key:"insertVariableUsage",value:function(e,t){var i=e.getLineNumber(),s=this.convertLocalIndexToLineIndex(i,t);if(-1!==s){var n,r=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(r.s();!(n=r.n()).done;){var o=n.value;o.getLineNumber()===i&&o.insertVariableUsage(s,e)}}catch(e){r.e(e)}finally{r.f()}}}},{key:"getFunctionCalls",value:function(){var e,t=new Map,i=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(i.s();!(e=i.n()).done;){var s,n=e.value.getFunctionCalls(),r=_createForOfIteratorHelper(n.keys());try{for(r.s();!(s=r.n()).done;){var o=s.value;t.has(o)?t.set(o,t.get(o).concat(n.get(o))):t.set(o,n.get(o))}}catch(e){r.e(e)}finally{r.f()}}}catch(e){i.e(e)}finally{i.f()}return t}},{key:"getOtherIdentifiers",value:function(){var e,t=new Set,i=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(i.s();!(e=i.n()).done;){var s,n=_createForOfIteratorHelper(e.value.getOtherIdentifiers());try{for(n.s();!(s=n.n()).done;){var r=s.value;t.add(r)}}catch(e){n.e(e)}finally{n.f()}}}catch(e){i.e(e)}finally{i.f()}return t}},{key:"getBuiltInCalls",value:function(){var e,t=new Set,i=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(i.s();!(e=i.n()).done;){var s,n=_createForOfIteratorHelper(e.value.getBuiltInFunctions());try{for(n.s();!(s=n.n()).done;){var r=s.value;t.add(r)}}catch(e){n.e(e)}finally{n.f()}}}catch(e){i.e(e)}finally{i.f()}return t}},{key:"getModules",value:function(){var e,t=new Map,i=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(i.s();!(e=i.n()).done;){var s=e.value;t=new Map(_toConsumableArray(t).concat(_toConsumableArray(s.getModules())))}}catch(e){i.e(e)}finally{i.f()}if(1===t.size&&_classPrivateFieldGet(this,_lines).length>1)for(var n=Array.from(t.values())[0],r=n.getEntity()!==_expression.ExpressionEntity.ModuleName,o=1;o<_classPrivateFieldGet(this,_lines).length;o++){var a,l=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines)[o].getExpressions());try{for(l.s();!(a=l.n()).done;){var p=a.value;if(p.is(_expression.ExpressionEntity.VariableName))if(r){var c=(0,_expression.keywordLookup)(p.getValue()),_=c.entity===_expression.ExpressionEntity.Unknown?_expression.ExpressionEntity.NamedImport:c.entity,u=c.category===_expression.ExpressionCategory.Unknown?_expression.ExpressionCategory.ImportedEntities:c.category,x=_expression.builtInReturnLookup.has(_)?_expression.builtInReturnLookup.get(_):_expression.DataType.Unknown;p.convert(_,u,x),n.addDirectImport(p.getValue(),(0,_identifiers.directImport)(_,u))}else p.convert(_expression.ExpressionEntity.NamedImport,_expression.ExpressionCategory.ImportedEntities,_expression.DataType.Unknown),n.addDirectImport(p.getValue(),(0,_identifiers.directImport)(_expression.ExpressionEntity.NamedImport,_expression.ExpressionCategory.ImportedEntities))}}catch(e){l.e(e)}finally{l.f()}}return t}},{key:"getFirstExpression",value:function(){if(!this.isBlank())return _classPrivateFieldGet(this,_lines)[0].getFirstExpression()}},{key:"getExpressionOnLine",value:function(e,t){var i,s=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(s.s();!(i=s.n()).done;){var n=i.value;if(n.getLineNumber()===e){var r=n.getExpressions();return t>=0&&t<r.length?r[t]:void 0}}}catch(e){s.e(e)}finally{s.f()}}},{key:"getCompoundExpression",value:function(){return _classPrivateFieldGet(this,_compoundExpression)}},{key:"indexOfEntity",value:function(e){return this.indexOfEntityAfterExpression(e,-1)}},{key:"allIndicesOfEntity",value:function(e){for(var t=[],i=this.getExpressions(),s=0;s<i.length;s++)i[s].is(e)&&t.push(s);return t}},{key:"indexOfEntityAfterExpression",value:function(e,t){for(var i=this.getExpressions(),s=t+1;s<i.length;s++)if(i[s].is(e))return s;return-1}},{key:"convertLineIndexToLocalIndex",value:function(e,t){if(!this.containsLine(e))return-1;for(var i=0;_classPrivateFieldGet(this,_lines)[i].getLineNumber()<e;)t+=_classPrivateFieldGet(this,_lines)[i].getExpressions().length,i++;return t<this.getExpressions().length?t:-1}},{key:"convertLocalIndexToLineIndex",value:function(e,t){if(!this.containsLine(e))return-1;for(var i=0;_classPrivateFieldGet(this,_lines)[i].getLineNumber()<e;)t-=_classPrivateFieldGet(this,_lines)[i].getExpressions().length,i++;return t>-1&&t<_classPrivateFieldGet(this,_lines)[i].getExpressions().length?t:-1}},{key:"getSymptoms",value:function(){return _classPrivateFieldGet(this,_symptoms)}},{key:"checkForSymptoms",value:function(){if(!this.isBlank()){_classPrivateMethodGet(this,_checkForWordyBool,_checkForWordyBool2).call(this),_classPrivateMethodGet(this,_checkForRedundantTernary,_checkForRedundantTernary2).call(this);var e=this.getExpressions(),t=this.indexOfEntity(_expression.ExpressionEntity.ReturnKeyword),i=this.indexOfEntityAfterExpression(_expression.ExpressionEntity.AssignmentOperator,t);if(e.length>0&&e[0].isOneOfEntities([_expression.ExpressionEntity.IfDefinition,_expression.ExpressionEntity.ElifDefinition,_expression.ExpressionEntity.WhileDefinition]))_classPrivateMethodGet(this,_processBooleanExpression,_processBooleanExpression2).call(this);else if(e.length>1&&e[0].isOneOfEntities([_expression.ExpressionEntity.FunctionDefinition,_expression.ExpressionEntity.ClassDefinition])){if(e[1].isOneOfCategories([_expression.ExpressionCategory.BlockDefinitions,_expression.ExpressionCategory.LogicalOperators,_expression.ExpressionCategory.Types,_expression.ExpressionCategory.OtherKeywords])){var s=e[0].getLineNumber();_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.DefinitionFollowedByReservedWord,s,this.getBlock().getId(),this.getDocumentStartingIndexOfLine(s)+e[0].getRawLocalIndex(),e[0].getRawLocalIndex(),this.getText(!0).substring(e[0].getRawLocalIndex(),e[1].getRawLocalIndex()+e[1].getValue().length),{definitionType:e[0].getValue(),reservedWord:e[1].getValue()}))}}else if(-1===t&&i>=0){for(var n=0;n<i;n++)if(e[n].isOneOfCategories([_expression.ExpressionCategory.BlockDefinitions,_expression.ExpressionCategory.LogicalOperators,_expression.ExpressionCategory.Types,_expression.ExpressionCategory.OtherKeywords])){var r=e[n].getLineNumber();_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.ReservedWordAssigned,r,this.getBlock().getId(),this.getDocumentStartingIndexOfLine(r)+e[n].getRawLocalIndex(),e[n].getRawLocalIndex(),e[n].getValue()))}}else if(t>=0&&i>=0&&!(0<=this.indexOfEntity(_expression.ExpressionEntity.PrintFunction)<i&&e[i-1].isOneOfEntities([_expression.ExpressionEntity.Sep,_expression.ExpressionEntity.End])||this.isExpressionInFunctionCall(i))){for(var o=e[i-1].getLineNumber(),a=[],l=t+1;l<i;l++)e[l].is(_expression.ExpressionEntity.VariableName)&&a.push(e[l].getValue());_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.AssignmentInReturn,o,this.getBlock().getId(),this.getDocumentStartingIndexOfLine(o)+e[i-1].getRawLocalIndex(),e[i-1].getRawLocalIndex(),this.getText(),{assignedVariables:a}))}}}},{key:"getDocumentLineNumber",value:function(){return 0===_classPrivateFieldGet(this,_lines)?-1:_classPrivateFieldGet(this,_lines)[0].getLineNumber()}},{key:"getIndent",value:function(){return 0===_classPrivateFieldGet(this,_lines)?-1:_classPrivateFieldGet(this,_lines)[0].getIndent()}},{key:"getDocumentStartingIndex",value:function(){return 0===_classPrivateFieldGet(this,_lines)?-1:_classPrivateFieldGet(this,_lines)[0].getStartingDocIndex()}},{key:"getDocumentStartingIndexOfLine",value:function(e){var t,i=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines));try{for(i.s();!(t=i.n()).done;){var s=t.value;if(s.getLineNumber()===e)return s.getStartingDocIndex()}}catch(e){i.e(e)}finally{i.f()}return-1}},{key:"getSequencesOfPattern",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=[],s=0,n=[],r=this.getExpressions(),o=-1===t?r.length:t,a=0;a<o;a++)r[a].isOneOfEntities(e[s])?(n.push(a),++s===e.length&&(i.push(n),n=[],s=0)):s>0&&(n=[],s=0);return i}},{key:"countOccurrencesOnLine",value:function(e,t){var i,s=0,n=_createForOfIteratorHelper(this.getExpressions());try{for(n.s();!(i=n.n()).done;){var r=i.value;r.is(e)&&r.is(t)&&s++}}catch(e){n.e(e)}finally{n.f()}return s}},{key:"getText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classPrivateFieldGet(this,_lines).map((function(t){return t.getRawContent(e)})).join("\n")}},{key:"getTextBetweenExpressions",value:function(e,t){var i=this.getExpressions(),s=i[e].getLineNumber(),n=i[t].getLineNumber(),r=i[e].is(_expression.ExpressionEntity.StringLiteral)?2:0,o=this.minLine();if(s<o||n>this.maxLine())return"Error getting text!";var a=_classPrivateMethodGet(this,_getLocalLineNumber,_getLocalLineNumber2).call(this,s);if(s===n)return _classPrivateFieldGet(this,_lines)[a].getRawContent(!0).substring(i[e].getRawLocalIndex()-r,i[t].getRawLocalIndex()+i[t].getValue().length);var l=[];l.push(_classPrivateFieldGet(this,_lines)[a].getRawContent(!0).substring(i[e].getRawLocalIndex()));for(var p=a+1;p<n-o;p++)l.push(_classPrivateFieldGet(this,_lines)[p].getRawContent(!0));return l.push(_classPrivateFieldGet(this,_lines)[_classPrivateMethodGet(this,_getLocalLineNumber,_getLocalLineNumber2).call(this,n)].getRawContent(!0).substring(0,i[t].getRawLocalIndex()+i[t].getValue().length)),l.join("\n")}},{key:"isUnfinished",value:function(){return _classPrivateFieldGet(this,_lines).length>0&&_classPrivateFieldGet(this,_lines)[_classPrivateFieldGet(this,_lines).length-1].continuesOnNextLine()}}]),e}();function _closeFunctionCall2(e,t){for(var i=e+1,s=1,n=0;i<t.length;){if(t[i].is(_expression.ExpressionEntity.OpenParenthesis))s++;else if(t[i].is(_expression.ExpressionEntity.CloseParenthesis)&&s===++n)return i;i++}return-1}function _findStartOfWordyBooleanExpression2(e){for(var t=this.getExpressions(),i=0,s=e[0]-1;s>=0&&s<t.length;s--){if(t[s].isOneOfEntities([_expression.ExpressionEntity.IfDefinition,_expression.ExpressionEntity.ElifDefinition,_expression.ExpressionEntity.WhileDefinition,_expression.ExpressionEntity.AndOperator,_expression.ExpressionEntity.OrOperator])){i=s+1;break}if(t[s].isOneOfEntities([_expression.ExpressionEntity.CloseParenthesis,_expression.ExpressionEntity.CloseSquareBracket,_expression.ExpressionEntity.CloseBrace]))s=_classPrivateMethodGet(this,_findOpeningExpression,_findOpeningExpression2).call(this,t[s].getEntity(),s,t);else if(t[s].isOneOfEntities([_expression.ExpressionEntity.OpenParenthesis,_expression.ExpressionEntity.OpenSquareBracket,_expression.ExpressionEntity.OpenBrace])){i=s+1;break}}return t[i].getRawLocalIndex()}function _findOpeningExpression2(e,t,i){var s=_expression.ExpressionEntity.OpenParenthesis;e===_expression.ExpressionEntity.CloseSquareBracket?s=_expression.ExpressionEntity.OpenSquareBracket:e===_expression.ExpressionEntity.CloseBrace&&(s=_expression.ExpressionEntity.OpenBrace);for(var n=0,r=t-1;r>=0;r--)if(i[r].getEntity()===e)n++;else if(i[r].getEntity()===s){if(!(n>0))return r;n--}return 0}function _checkForRedundantTernary2(){for(var e=[[_expression.ExpressionEntity.TrueType,_expression.ExpressionEntity.FalseType],[_expression.ExpressionEntity.IfDefinition]],t=this.getExpressions(),i=0;i<_classPrivateFieldGet(this,_lines).length;i++){var s,n=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines)[i].getSequencesOfPattern(e));try{for(n.s();!(s=n.n()).done;)for(var r=s.value,o=this.convertLineIndexToLocalIndex(_classPrivateFieldGet(this,_lines)[i].getLineNumber(),r[0]),a=this.convertLineIndexToLocalIndex(_classPrivateFieldGet(this,_lines)[i].getLineNumber(),r[1])+1,l=a+1;l<t.length-1;){if(t[l].is(_expression.ExpressionEntity.ElseDefinition)){(t[o].is(_expression.ExpressionEntity.TrueType)&&t[l+1].is(_expression.ExpressionEntity.FalseType)||t[o].is(_expression.ExpressionEntity.FalseType)&&t[l+1].is(_expression.ExpressionEntity.TrueType))&&_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.TernaryReturnsBool,_classPrivateFieldGet(this,_lines)[i].getLineNumber(),this.getBlock().getId(),_classPrivateFieldGet(this,_lines)[i].getStartingDocIndex()+t[o].getRawLocalIndex(),t[o].getRawLocalIndex(),_classPrivateFieldGet(this,_lines)[i].getRawContent(!0).substring(t[o].getRawLocalIndex(),t[l+1].getRawLocalIndex()+t[l+1].getValue().length),{boolValue:_classPrivateFieldGet(this,_lines)[i].getRawContent(!0).substring(t[a].getRawLocalIndex(),t[l-1].getRawLocalIndex()+t[l-1].getValue().length),boolLiteralIfTrue:t[o].getValue(),boolLiteralIfFalse:t[l+1].getValue()}));break}l++}}catch(e){n.e(e)}finally{n.f()}}}function _checkForWordyBool2(){for(var e=[[_expression.ExpressionEntity.EqualOperator,_expression.ExpressionEntity.IsKeyword],[_expression.ExpressionEntity.TrueType,_expression.ExpressionEntity.FalseType]],t=0;t<_classPrivateFieldGet(this,_lines).length;t++){var i,s=_createForOfIteratorHelper(_classPrivateFieldGet(this,_lines)[t].getSequencesOfPattern(e));try{for(s.s();!(i=s.n()).done;){var n=i.value;n[0]=this.convertLineIndexToLocalIndex(_classPrivateFieldGet(this,_lines)[t].getLineNumber(),n[0]),n[1]=this.convertLineIndexToLocalIndex(_classPrivateFieldGet(this,_lines)[t].getLineNumber(),n[1]);var r=_classPrivateMethodGet(this,_findStartOfWordyBooleanExpression,_findStartOfWordyBooleanExpression2).call(this,n),o=this.getExpressions(),a=o[n[1]].getRawLocalIndex()+o[n[1]].getValue().length,l=_classPrivateFieldGet(this,_lines)[t].getStartingDocIndex()+r;_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.CompareBoolLiteral,_classPrivateFieldGet(this,_lines)[t].getLineNumber(),this.getBlock().getId(),l,r,_classPrivateFieldGet(this,_lines)[t].getRawContent(!0).substring(r,a),{boolValue:_classPrivateFieldGet(this,_lines)[t].getRawContent(!0).substring(r,o[n[0]].getRawLocalIndex()),operator:o[n[0]].getValue(),boolLiteral:o[n[1]].getValue()}))}}catch(e){s.e(e)}finally{s.f()}}}function _getLocalLineNumber2(e){for(var t=0;t<_classPrivateFieldGet(this,_lines).length;t++)if(_classPrivateFieldGet(this,_lines)[t].getLineNumber()===e)return t;return-1}function _processBooleanExpression2(){for(var e=[_expression.ExpressionEntity.AndOperator,_expression.ExpressionEntity.OrOperator,_expression.ExpressionEntity.IsKeyword],t=this.getExpressions(),i=0,s=0,n=0,r=0;r<t.length-1;r++){var o=t[r].getLineNumber(),a=_classPrivateMethodGet(this,_getLocalLineNumber,_getLocalLineNumber2).call(this,o),l=this.getBlock().getId(),p=t[r].getRawLocalIndex(),c=_classPrivateFieldGet(this,_lines)[a].getStartingDocIndex()+p;if(0===r&&(t[r+1].isOneOfEntities(e)||t[r+1].is(_expression.ExpressionCategory.ComparisonOperators)))_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.OutOfPlaceBooleanOperator,o,l,c,p,t[r].getValue()+" "+t[r+1].getValue()));else if(_classPrivateMethodGet(this,_isPossibleSplitComparisonOperator,_isPossibleSplitComparisonOperator2).call(this,t[r],t[r+1]))_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.DoubleBooleanOperators,o,l,c,p,t[r].getValue()+" "+t[r+1].getValue()));else if(t[r].is(_expression.ExpressionEntity.AssignmentOperator)){for(var _=r;_>0&&!t[_-1].isOneOfCategories([_expression.ExpressionCategory.BlockDefinitions,_expression.ExpressionCategory.OtherKeywords,_expression.ExpressionCategory.LogicalOperators,_expression.ExpressionCategory.ComparisonOperators]);)_--;for(var u=r;u<t.length-1&&!t[u+1].isOneOfCategories([_expression.ExpressionCategory.BlockDefinitions,_expression.ExpressionCategory.OtherKeywords,_expression.ExpressionCategory.LogicalOperators,_expression.ExpressionCategory.ComparisonOperators]);)u++;var x=this.getTextBetweenExpressions(_,u);_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.AssignmentInBoolean,o,l,_classPrivateFieldGet(this,_lines)[a].getStartingDocIndex()+t[_].getRawLocalIndex(),t[_].getRawLocalIndex(),x))}else if(t[r].is(_expression.ExpressionEntity.AndOperator)&&t[r+1].is(_expression.ExpressionEntity.OrOperator))_classPrivateFieldGet(this,_symptoms).push(_symptom.Symptom.create(_symptom.SymptomType.AndOr,o,l,c,p,t[r].getValue()+" "+t[r+1].getValue()));else if(t[r].is(_expression.ExpressionEntity.OpenParenthesis))i++;else if(t[r].is(_expression.ExpressionEntity.CloseParenthesis))i--;else if(t[r].is(_expression.ExpressionEntity.OpenSquareBracket))s++;else if(t[r].is(_expression.ExpressionEntity.CloseSquareBracket))s--;else if(t[r].is(_expression.ExpressionEntity.OpenBrace))n++;else if(t[r].is(_expression.ExpressionEntity.CloseBrace))n--;else if(t[r].is(_expression.ExpressionEntity.Colon)&&0===i&&0===s&&0===n)break}}function _isPossibleSplitComparisonOperator2(e,t){return(e.is(_expression.ExpressionCategory.ComparisonOperators)||e.is(_expression.ExpressionEntity.AssignmentOperator)||e.is(_expression.ExpressionEntity.Unknown)&&e.is("!"))&&(t.is(_expression.ExpressionCategory.ComparisonOperators)||t.isOneOfEntities([_expression.ExpressionEntity.AssignmentOperator,_expression.ExpressionEntity.IsKeyword])||t.is(_expression.ExpressionEntity.Unknown)&&t.is("!"))}exports.ExecutionLine=ExecutionLine;
